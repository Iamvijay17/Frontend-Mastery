name: Deploy Workflow

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Record Start Time
        id: start
        run: echo "time=$(date +%s)" >> "$GITHUB_OUTPUT"

      - name: Checkout Code
        uses: actions/checkout@v4

      # ✅ Add your build/deploy steps here
      # Example:
      # - name: Deploy to GitHub Pages
      #   uses: peaceiris/actions-gh-pages@v3
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     publish_dir: ./dist

      - name: Record End Time
        id: end
        run: echo "time=$(date +%s)" >> "$GITHUB_OUTPUT"

      - name: Calculate Duration
        id: duration
        run: |
          start=${{ steps.start.outputs.time }}
          end=${{ steps.end.outputs.time }}
          duration=$((end - start))
          mins=$((duration / 60))
          secs=$((duration % 60))
          echo "duration=${mins}m ${secs}s" >> "$GITHUB_OUTPUT"

      - name: Send Email Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "🚀 GitHub Deploy: ${{ job.status }}"
          to: vijay9578979255@gmail.com
          from: GitHub Actions
          content_type: text/html
          body: |
            <!DOCTYPE html>
            <html>
            <head>
              <meta charset="UTF-8" />
              <title>Deployment Status</title>
            </head>
            <body style="font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px;">
              <div style="max-width: 600px; margin: auto; background-color: #fff; border: 1px solid #ccc; border-radius: 8px;">
                <div style="background-color: #24292e; padding: 16px; color: white;">
                  <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub Logo" width="30" style="vertical-align: middle;">
                  <span style="font-size: 18px; margin-left: 10px;">GitHub Deployment Notification</span>
                </div>

                <div style="padding: 20px;">
                  <h2 style="color: #2ecc71;">🚀 Deployment Details</h2>

                  <p><strong>📅 Time:</strong> ${{ github.event.head_commit.timestamp }}</p>
                  <p><strong>⏱️ Duration:</strong> ${{ steps.duration.outputs.duration }}</p>
                  <p><strong>👤 Deployer:</strong> <a href="https://github.com/${{ github.actor }}" style="color:#0366d6;">${{ github.actor }}</a></p>
                  <p><strong>📁 Repository:</strong> <code>${{ github.repository }}</code></p>
                  <p><strong>🌿 Branch:</strong> <code>${{ github.ref_name }}</code></p>
                  <p><strong>🔢 Commit SHA:</strong> <a href="https://github.com/${{ github.repository }}/commit/${{ github.sha }}" style="color:#0366d6;">${{ github.sha }}</a></p>
                  <p><strong>📝 Commit Message:</strong><br />
                    <em>${{ github.event.head_commit.message }}</em>
                  </p>
                  <p><strong>📊 Status:</strong> <strong style="color: ${{ job.status == 'success' && 'green' || 'red' }};">${{ job.status }}</strong></p>
                  <p><strong>🌐 GitHub Pages:</strong>
                    <a href="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/" style="color:#0366d6;">
                      View Site
                    </a>
                  </p>
                </div>

                <div style="background-color: #f0f0f0; padding: 10px; text-align: center; font-size: 12px; color: #777;">
                  💬 This is an automated email sent by GitHub Actions.
                </div>
              </div>
            </body>
            </html>